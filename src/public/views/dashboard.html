<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Termux Panel - Dashboard</title>
  <script src="https://unpkg.com/htmx.org@1.9.6"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen font-sans">



  <!-- Navigation Bar -->
  <nav class="bg-gray-800 text-white p-4 flex justify-between">
    <div class="font-bold">Termux Panel</div>
    <div class="space-x-4">
      <a href="/" class="hover:text-gray-300">Dashboard</a>
      <a href="/system" class="hover:text-gray-300">System</a>
      <a href="/apps" class="hover:text-gray-300">Apps</a>
      <a href="/logs" class="hover:text-gray-300">Logs</a>
      <a href="/settings" class="hover:text-gray-300">Settings</a>
    </div>
  </nav>


      <h1 class="m-4 text-2xl font-bold mb-4">Termux Panel Dashboard</h1>

  <!-- SYSTEM STATS SECTION -->
<section class="mb-6 m-4">
  <h2 class="text-xl font-semibold mb-2">System & Network Stats</h2>
  <div 
    id="system-stats"
    hx-get="/api/system/stats" 
    hx-trigger="load" 
    hx-target="#system-stats" 
    hx-swap="innerHTML"
  >
    <div class="p-4 bg-white rounded shadow">Loading system stats...</div>
  </div>
</section>


  <!-- INSTALLED APPS SECTION -->
  <section class="m-4">
    <h2 class="text-xl font-semibold mb-2">Installed Apps</h2>
    <div 
      hx-get="/api/apps" 
      hx-trigger="load" 
      hx-target="#installed-apps" 
      hx-swap="innerHTML"
    >
      <div id="installed-apps">
        <div class="p-4 bg-white rounded shadow">Loading installed apps...</div>
      </div>
    </div>
  </section>

  <script>
    document.body.addEventListener('htmx:afterSwap', (event) => {
      // SYSTEM STATS TRANSFORMATION
      if(event.target.id === 'system-stats' && event.detail.xhr){
        try {
          const data = JSON.parse(event.detail.xhr.responseText).data;
          const container = document.getElementById('system-stats');
          container.innerHTML = '';

          // CPU, RAM, Disk, Uptime cards
          const stats = [
            { label: 'CPU Usage', value: data.cpu },
            { label: 'RAM Usage', value: data.ram },
            { label: 'Disk Usage', value: data.disk },
            { label: 'Uptime', value: data.uptime }
          ];
          stats.forEach(stat => {
            const card = document.createElement('div');
            card.className = "p-4 bg-white rounded shadow";
            card.innerHTML = `<div class="font-semibold">${stat.label}</div><div class="text-lg">${stat.value}</div>`;
            container.appendChild(card);
          });

          // NETWORK INFO CARD
          if(data.network){
            const net = data.network;
            const netCard = document.createElement('div');
            netCard.className = "p-4 bg-white rounded shadow ";
            netCard.innerHTML = `
              <div class="font-semibold mb-2">Network Info</div>
              <div class="text-sm text-gray-700">
                Private IP: ${net.private_ip || 'N/A'}<br>
                Public IP: ${net.public_ip || 'N/A'}<br>
                Gateway: ${net.gateway || 'N/A'}<br>
                Interface: ${net.interface || 'N/A'}
              </div>
            `;
            container.appendChild(netCard);
          }

        } catch(e){ console.error("Error parsing system stats:", e); }
      }

      // INSTALLED APPS TRANSFORMATION
      if(event.target.id === 'installed-apps' && event.detail.xhr){
        try {
          const apps = JSON.parse(event.detail.xhr.responseText).data.installed;
          const container = document.getElementById('installed-apps');
          container.innerHTML = '';

          if(apps.length === 0){
            container.innerHTML = '<div class="text-gray-500 p-4">No apps installed yet.</div>';
          } else {
            apps.forEach(app => {
              const card = document.createElement('div');
              card.className = "p-4 bg-white rounded shadow flex justify-between items-center";
              card.innerHTML = `
                <div>
                  <div class="font-semibold">${app.name}</div>
                  <div class="text-sm text-gray-500">Status: <span class="font-medium">${app.status || 'stopped'}</span></div>
                </div>
                <div class="flex space-x-2">
                  <button class="px-2 py-1 bg-green-500 text-white rounded" hx-post="/api/apps/${app.id}/start" hx-target="closest div" hx-swap="outerHTML">Start</button>
                  <button class="px-2 py-1 bg-yellow-500 text-white rounded" hx-post="/api/apps/${app.id}/stop" hx-target="closest div" hx-swap="outerHTML">Stop</button>
                  <button class="px-2 py-1 bg-red-500 text-white rounded" hx-post="/api/apps/${app.id}/restart" hx-target="closest div" hx-swap="outerHTML">Restart</button>
                </div>`;
              container.appendChild(card);
            });
          }

        } catch(e){ console.error("Error parsing installed apps:", e); }
      }
    });
  </script>

</body>
</html>
